# ===========================================================
# Photonix 后端服务环境变量配置
# ===========================================================

# 这些变量定义了后端服务如何连接到外部服务），
# 以及一些运行时的行为。
# 本文件位于项目根目录，由 docker-compose.yml 通过 env_file 加载。

# --- Redis 缓存配置 ---
# Redis 连接 URL。
# 如果使用我提供的 docker-compose.yml 启动 Redis，那么'redis://redis:6379' 是正确的。
# 'redis' 是 docker-compose 网络中 Redis 服务的名称，'6379'是 Redis 的默认端口。
REDIS_URL=redis://redis:6379

# --- 服务配置 ---
# 服务监听的端口。
# 默认是 13001。如果您想更改，请在这里设置。
PORT=13001

# Node.js 运行环境模式。
# 'production' 模式通常会启用性能优化和更少的日志输出。
# 'development' 模式可能包含更多调试信息。
NODE_ENV=production

# --- 日志级别 ---
# 控制应用程序的日志输出详细程度。
# 可选值：debug, info, warn, error, fatal。
# 'info' 会输出信息、警告和错误日志。
LOG_LEVEL=info


# 调整速率限制（可选，默认 15 分钟/100 次，未设置将使用默认）
# API 速率限制的时间窗口（分钟）
RATE_LIMIT_WINDOW_MINUTES=1
# 在一个时间窗口内，单个 IP 允许的最大请求数
RATE_LIMIT_MAX_REQUESTS=500

# --- 安全配置 ---
# 用于签发和验证登录 Token 的密钥，请修改为一个复杂的、随机的字符串
JWT_SECRET=your-own-very-long-and-random-secret-string-12345

# 超级管理员密码，用于修改关键设置
ADMIN_SECRET=admin



# ================= 可自定义配置（全部为可选，默认无需配置，按需取消注释） =================

# --- SQLite 初始超时（程序会自适应调整，一般无需配置） ---
# SQLITE_BUSY_TIMEOUT=20000
# SQLITE_QUERY_TIMEOUT=30000

# --- 后台缩略图对账循环参数（一般无需配置） ---
# THUMB_RECONCILE_BATCH_SIZE=300
# THUMB_RECONCILE_DELAY_MS=500

# --- 索引/缓存相关（一般无需配置） ---
# INDEX_STABILIZE_DELAY_MS=5000
# TAG_INVALIDATION_MAX_TAGS=2000
# THUMB_CHECK_BATCH_SIZE=200
# THUMB_CHECK_BATCH_DELAY_MS=100
# COVER_INFO_LRU_SIZE=4000
# ROUTE_CACHE_BROWSE_PATTERN=route_cache:*:/api/browse*

# --- 可选：服务 Redis 兜底缓存 ---
# SETTINGS_REDIS_CACHE=true

# --- 文件监控（对 NFS 友好，但更耗 CPU） ---
# WATCH_USE_POLLING=true

# --- 维护任务（CRON 与对账开关） ---
# 默认每小时执行一次维护任务；可修改为 "*/30 * * * *" 等表达式
MAINTENANCE_CRON=0 * * * *
# 维护任务的功能开关（默认同时执行目录对账与缩略图对账）
MAINTENANCE_FLAGS="--reconcile-dirs --reconcile-thumbs"

# --- 文件系统模式与 NFS 同步 ---
# auto|inotify|nfs，auto 下自动探测，nfs 下不启用 chokidar，仅用对账
FS_MODE=auto
# 是否开启 NFS 目录级对账（仅在需要时开启）
ENABLE_NFS_SYNC=false
# 是否开启缩略图存在性对账（默认开启，低频批处理）
ENABLE_THUMB_RECON=true

# --- Worker 资源与图片像素护栏 ---
# 单个 Worker 的老生代最大内存（MB）
WORKER_MEMORY_MB=512
# sharp 单图最大像素（默认 24k x 24k）
SHARP_MAX_PIXELS=576000000

# --- AI 缓存（仅 AI worker 使用；单位字节；默认 256MB） ---
# AI_CACHE_MAX_BYTES=268435456

# --- AI 功能限流（仅启用 AI 时可配置） ---
# AI_DAILY_LIMIT=200
# AI_PER_IMAGE_COOLDOWN_SEC=60
